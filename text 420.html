<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YSFLIX</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0a0a0a; --bg-secondary: #141414; --card: #1a1a1a; --card-hover: #242424;
            --border: #333333; --fg: #f0f0f0; --muted: #888888; --accent: #e53935; --accent-dark: #b71c1c;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { width: 100%; min-height: 100vh; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--fg); overflow-x: hidden; }
        .font-display { font-family: 'Bebas Neue', sans-serif; }
        ::-webkit-scrollbar { width: 5px; } ::-webkit-scrollbar-track { background: var(--bg); } ::-webkit-scrollbar-thumb { background: #444; border-radius: 3px; }

        /* Loading */
        .loading-screen { position: fixed; inset: 0; background: var(--bg); z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: opacity 0.3s; }
        .loading-screen.hidden { opacity: 0; pointer-events: none; }
        .loading-logo { font-family: 'Bebas Neue', sans-serif; font-size: 48px; letter-spacing: 6px; color: var(--accent); margin-bottom: 30px; }
        .loading-bar { width: 200px; height: 3px; background: #333; border-radius: 3px; overflow: hidden; }
        .loading-bar-fill { height: 100%; background: var(--accent); animation: load 1.5s ease forwards; }
        @keyframes load { 0% { width: 0; } 100% { width: 100%; } }

        .content-section { display: none; }
        .content-section.active { display: block; }

        /* Navigation */
        .nav-container { position: sticky; top: 0; z-index: 100; background: rgba(10, 10, 10, 0.98); border-bottom: 1px solid var(--border); padding: 0 16px; }
        .nav-inner { display: flex; align-items: center; justify-content: space-between; height: 54px; max-width: 1100px; margin: 0 auto; }
        .logo { letter-spacing: 3px; font-size: 20px; cursor: pointer; color: var(--accent); }
        .nav-actions { display: flex; align-items: center; gap: 6px; }
        .search-wrapper { display: none; align-items: center; gap: 8px; }
        .search-wrapper.active { display: flex; }
        .search-input-nav { background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 20px; padding: 8px 14px; color: var(--fg); font-size: 13px; width: 200px; }
        .search-input-nav:focus { outline: none; border-color: var(--accent); }
        .nav-btn { background: transparent; border: 1px solid var(--border); color: var(--muted); width: 34px; height: 34px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s; }
        .nav-btn:hover { border-color: var(--accent); color: var(--accent); }

        /* Menu Dropdown */
        .menu-dropdown { position: fixed; top: 54px; right: 0; width: 200px; background: var(--card); border: 1px solid var(--border); border-top: none; border-radius: 0 0 8px 8px; z-index: 150; display: none; }
        .menu-dropdown.active { display: block; }
        .menu-item { display: flex; align-items: center; gap: 10px; padding: 12px 14px; color: var(--muted); cursor: pointer; border-bottom: 1px solid var(--border); transition: all 0.2s; }
        .menu-item:last-child { border-bottom: none; }
        .menu-item:hover { background: var(--bg-secondary); color: var(--fg); }
        .menu-item.active { color: var(--accent); background: rgba(229, 57, 53, 0.1); }

        /* Main Container */
        .main-container { width: 100%; padding: 16px; max-width: 1100px; margin: 0 auto; }

        /* Section Header */
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .section-title { font-family: 'Bebas Neue', sans-serif; font-size: 22px; letter-spacing: 1px; }
        .view-all { color: var(--accent); font-size: 12px; cursor: pointer; }
        .view-all:hover { text-decoration: underline; }

        /* Movie Grid - Style Like Screenshot 2 */
        /* 3 Columns on Desktop, Responsive down */
        .movie-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
        @media (max-width: 800px) { .movie-grid { grid-template-columns: repeat(2, 1fr); gap: 12px; } }

        .movie-card { background: var(--card); border-radius: 8px; overflow: hidden; cursor: pointer; border: 1px solid transparent; transition: all 0.25s; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        .movie-card:hover { border-color: var(--accent); transform: translateY(-4px); box-shadow: 0 8px 15px rgba(0,0,0,0.4); }
        
        /* Poster Area */
        .movie-poster { position: relative; aspect-ratio: 2/3; overflow: hidden; background: #222; }
        .movie-poster img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s; }
        .movie-card:hover .movie-poster img { transform: scale(1.05); }
        
        /* Badges - Positioned as per Screenshot 2 */
        .rating-badge { position: absolute; top: 8px; right: 8px; background: rgba(0,0,0,0.85); border: 1px solid var(--accent); border-radius: 4px; padding: 2px 6px; font-size: 11px; font-weight: 600; color: var(--accent); }
        .year-badge { position: absolute; top: 8px; left: 8px; background: rgba(0,0,0,0.85); border-radius: 4px; padding: 2px 6px; font-size: 11px; color: #fff; }
        .quality-badge { position: absolute; bottom: 8px; left: 8px; background: var(--accent); border-radius: 4px; padding: 3px 8px; font-size: 10px; font-weight: 700; color: #fff; text-transform: uppercase; }
        
        /* Info Area */
        .movie-info { padding: 12px; }
        .movie-title { font-size: 14px; font-weight: 600; margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .movie-meta { font-size: 12px; color: var(--muted); }

        /* Pagination */
        .pagination { display: flex; justify-content: center; align-items: center; gap: 6px; margin-top: 24px; }
        .page-btn { background: var(--card); border: 1px solid var(--border); color: var(--muted); padding: 8px 14px; border-radius: 4px; font-size: 13px; cursor: pointer; transition: all 0.2s; }
        .page-btn:hover { border-color: var(--accent); color: var(--fg); }
        .page-btn.active { background: var(--accent); border-color: var(--accent); color: #fff; }
        .page-btn:disabled { opacity: 0.4; cursor: not-allowed; }

        /* Genre Grid */
        .genre-section { margin-top: 28px; }
        .genre-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 10px; }
        @media (max-width: 700px) { .genre-grid { grid-template-columns: repeat(3, 1fr); } }
        .genre-card { background: var(--card); border: 1px solid var(--border); border-radius: 6px; padding: 12px; text-align: center; cursor: pointer; transition: all 0.2s; }
        .genre-card:hover { border-color: var(--accent); }
        .genre-icon { font-size: 18px; margin-bottom: 4px; }
        .genre-name { font-size: 11px; font-weight: 500; }
        .genre-count { font-size: 10px; color: var(--muted); }

        /* Tags */
        .tags-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 10px; margin-top: 16px; }
        .tag-card { background: var(--card); border: 1px solid var(--border); border-radius: 6px; padding: 10px 12px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; transition: all 0.2s; }
        .tag-card:hover { border-color: var(--accent); }

        /* Modal */
        .modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.92); z-index: 200; display: none; overflow-y: auto; }
        .modal-backdrop.active { display: flex; align-items: flex-start; justify-content: center; padding: 20px; }
        .modal-content { background: var(--card); border: 1px solid var(--border); border-radius: 10px; width: 100%; max-width: 850px; max-height: 90vh; overflow-y: auto; position: relative; }

        /* Login */
        .login-modal { max-width: 360px; padding: 28px; margin: auto; }
        .login-title { font-family: 'Bebas Neue', sans-serif; font-size: 26px; letter-spacing: 2px; text-align: center; margin-bottom: 6px; }
        .login-input { width: 100%; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 6px; padding: 12px 14px; color: var(--fg); font-size: 14px; margin-bottom: 12px; }
        .login-input:focus { outline: none; border-color: var(--accent); }
        .login-btn { width: 100%; background: var(--accent); color: #fff; border: none; padding: 12px; border-radius: 6px; font-size: 14px; font-weight: 600; cursor: pointer; }
        .login-error { background: rgba(229,57,53,0.1); border: 1px solid var(--accent); border-radius: 6px; padding: 10px; color: var(--accent); font-size: 12px; text-align: center; margin-bottom: 12px; display: none; }

        /* Admin Modal */
        .admin-modal { padding: 18px; }
        .admin-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 14px; }
        .admin-title { font-family: 'Bebas Neue', sans-serif; font-size: 22px; letter-spacing: 1px; }
        .admin-close { background: transparent; border: none; color: var(--muted); cursor: pointer; font-size: 24px; padding: 4px; }
        .admin-tabs { display: flex; gap: 4px; margin-bottom: 14px; background: var(--bg-secondary); padding: 4px; border-radius: 6px; overflow-x: auto; }
        .admin-tab { padding: 10px 16px; border-radius: 4px; font-size: 12px; font-weight: 500; cursor: pointer; color: var(--muted); white-space: nowrap; transition: all 0.2s; }
        .admin-tab:hover { color: var(--fg); }
        .admin-tab.active { background: var(--accent); color: #fff; }
        .admin-panel-section { display: none; }
        .admin-panel-section.active { display: block; }

        /* TMDB Search */
        .tmdb-search { background: var(--bg-secondary); border-radius: 8px; padding: 14px; margin-bottom: 18px; }
        .tmdb-row { display: flex; gap: 8px; flex-wrap: wrap; align-items: flex-end; }
        .tmdb-filter { display: flex; flex-direction: column; gap: 4px; }
        .tmdb-filter label { font-size: 10px; color: var(--muted); text-transform: uppercase; }
        .tmdb-input, .tmdb-select { background: var(--bg); border: 1px solid var(--border); border-radius: 4px; padding: 10px 12px; color: var(--fg); font-size: 13px; min-width: 80px; }
        .tmdb-input:focus, .tmdb-select:focus { outline: none; border-color: var(--accent); }
        .tmdb-btn { background: var(--accent); color: #fff; border: none; padding: 10px 18px; border-radius: 4px; font-size: 12px; font-weight: 600; cursor: pointer; white-space: nowrap; transition: all 0.2s; }
        .tmdb-btn:hover { background: var(--accent-dark); }
        .tmdb-btn:disabled { background: #666; cursor: not-allowed; }
        .tmdb-btn.secondary { background: var(--bg); border: 1px solid var(--border); color: var(--fg); }
        .tmdb-btn.secondary:hover { border-color: var(--accent); color: var(--accent); }
        .tmdb-btn.success { background: #2e7d32; }
        .tmdb-btn.success:hover { background: #1b5e20; }

        /* Results Grid */
        .results-container { margin-top: 14px; }
        .results-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 12px; }
        @media (max-width: 900px) { .results-grid { grid-template-columns: repeat(4, 1fr); } }
        @media (max-width: 600px) { .results-grid { grid-template-columns: repeat(3, 1fr); } }

        .result-card { background: var(--bg); border-radius: 6px; overflow: hidden; cursor: pointer; border: 1px solid transparent; transition: all 0.2s; }
        .result-card:hover { border-color: var(--accent); transform: translateY(-3px); }
        .result-card.selected { border-color: var(--accent); box-shadow: 0 0 0 2px var(--accent); }
        .result-poster { position: relative; aspect-ratio: 2/3; overflow: hidden; }
        .result-poster img { width: 100%; height: 100%; object-fit: cover; }
        .result-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.2s; }
        .result-card:hover .result-overlay { opacity: 1; }
        .result-overlay span { background: var(--accent); color: #fff; padding: 8px 14px; border-radius: 4px; font-size: 11px; font-weight: 600; }
        .result-check { position: absolute; top: 6px; right: 6px; background: var(--accent); color: #fff; width: 20px; height: 20px; border-radius: 50%; display: none; align-items: center; justify-content: center; font-size: 11px; font-weight: bold; }
        .result-card.selected .result-check { display: flex; }
        .result-info { padding: 10px; }
        .result-title { font-size: 11px; font-weight: 600; margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .result-meta { font-size: 10px; color: var(--muted); }

        /* Selected Bar */
        .selected-bar { background: var(--bg-secondary); border-radius: 8px; padding: 12px 16px; margin-top: 14px; display: none; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 10px; }
        .selected-bar.active { display: flex; }
        .selected-bar-left { display: flex; align-items: center; gap: 10px; }
        .selected-count { background: var(--accent); color: #fff; padding: 4px 10px; border-radius: 4px; font-size: 12px; font-weight: 600; }

        /* Movie Detail */
        .movie-detail { background: var(--bg-secondary); border-radius: 8px; padding: 16px; margin-top: 14px; display: none; }
        .movie-detail.active { display: block; }
        .movie-detail-header { display: flex; gap: 16px; margin-bottom: 14px; }
        .movie-detail-poster { width: 100px; height: 150px; object-fit: cover; border-radius: 6px; }
        .movie-detail-info { flex: 1; }
        .movie-detail-info h3 { font-size: 18px; font-weight: 600; margin-bottom: 8px; }
        .movie-detail-info p { font-size: 12px; color: var(--muted); line-height: 1.6; }

        /* Season Episode */
        .season-episode-section { background: var(--bg); border-radius: 6px; padding: 12px; margin-top: 12px; display: none; }
        .season-episode-section.active { display: block; }
        .season-episode-row { display: flex; gap: 16px; flex-wrap: wrap; align-items: center; }
        .se-select { display: flex; align-items: center; gap: 8px; }
        .se-select label { font-size: 12px; color: var(--muted); }
        .se-select select { background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 4px; padding: 8px 12px; color: var(--fg); font-size: 12px; cursor: pointer; }

        /* Servers */
        .servers-section { margin-top: 12px; display: none; }
        .servers-section.active { display: block; }
        .servers-list { display: flex; flex-direction: column; gap: 8px; }
        .server-item { display: flex; gap: 6px; align-items: center; background: var(--bg); border-radius: 6px; padding: 10px; flex-wrap: wrap; }
        .server-input { background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 4px; padding: 8px 10px; color: var(--fg); font-size: 12px; }
        .server-input:focus { outline: none; border-color: var(--accent); }
        .server-remove { background: transparent; border: none; color: var(--accent); cursor: pointer; font-size: 18px; padding: 0 4px; }
        .quick-servers { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 10px; }
        .quick-server-btn { background: var(--bg); border: 1px solid var(--border); color: var(--muted); padding: 6px 10px; border-radius: 4px; font-size: 11px; cursor: pointer; transition: all 0.2s; }
        .quick-server-btn:hover { border-color: var(--accent); color: var(--accent); }
        .add-server-btn { background: transparent; border: 1px dashed var(--border); color: var(--muted); padding: 10px; border-radius: 6px; font-size: 12px; cursor: pointer; width: 100%; margin-top: 8px; transition: all 0.2s; }
        .add-server-btn:hover { border-color: var(--accent); color: var(--accent); }

        /* Form */
        .admin-form { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        @media (max-width: 600px) { .admin-form { grid-template-columns: 1fr; } }
        .form-group { display: flex; flex-direction: column; gap: 4px; }
        .form-group.full-width { grid-column: 1 / -1; }
        .form-label { font-size: 10px; font-weight: 500; color: var(--muted); text-transform: uppercase; }
        .form-input, .form-select, .form-textarea { background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 6px; padding: 10px 12px; color: var(--fg); font-size: 13px; }
        .form-input:focus, .form-select:focus, .form-textarea:focus { outline: none; border-color: var(--accent); }
        .form-textarea { min-height: 80px; resize: vertical; }

        .btn-primary { background: var(--accent); color: #fff; border: none; padding: 10px 18px; border-radius: 6px; font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .btn-primary:hover { background: var(--accent-dark); }
        .btn-secondary { background: var(--bg-secondary); border: 1px solid var(--border); color: var(--fg); padding: 10px 18px; border-radius: 6px; font-size: 13px; cursor: pointer; transition: all 0.2s; }
        .btn-secondary:hover { border-color: var(--accent); }
        .btn-danger { background: #c62828; color: #fff; border: none; padding: 8px 14px; border-radius: 4px; font-size: 12px; font-weight: 600; cursor: pointer; }

        /* Saved List */
        .saved-list { display: flex; flex-direction: column; gap: 6px; max-height: 350px; overflow-y: auto; }
        .saved-item { display: flex; align-items: center; gap: 10px; padding: 10px; background: var(--bg-secondary); border-radius: 6px; transition: all 0.2s; }
        .saved-item:hover { background: var(--card-hover); }
        .saved-item img { width: 40px; height: 60px; object-fit: cover; border-radius: 4px; }
        .saved-item-info { flex: 1; min-width: 0; }
        .saved-item-title { font-size: 12px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .saved-item-meta { font-size: 10px; color: var(--muted); }
        .saved-item-actions { display: flex; gap: 6px; }
        .btn-edit { background: var(--accent); color: #fff; border: none; padding: 5px 10px; border-radius: 4px; font-size: 10px; cursor: pointer; }
        .btn-delete { background: #c62828; color: #fff; border: none; padding: 5px 10px; border-radius: 4px; font-size: 10px; cursor: pointer; }

        /* Download Table */
        .download-table { width: 100%; border-collapse: collapse; margin-top: 12px; }
        .download-table th { background: var(--bg-secondary); padding: 10px; text-align: left; font-size: 10px; text-transform: uppercase; color: var(--muted); border-bottom: 1px solid var(--border); }
        .download-table td { padding: 10px; border-bottom: 1px solid var(--border); font-size: 12px; }
        .download-link { display: inline-flex; align-items: center; gap: 4px; background: var(--accent); color: #fff; padding: 6px 14px; border-radius: 4px; font-size: 11px; font-weight: 600; text-decoration: none; }
        .download-link:hover { background: var(--accent-dark); }

        /* Download Warning */
        .download-warning { background: rgba(229,57,53,0.1); border: 1px solid var(--accent); border-radius: 6px; padding: 16px; text-align: center; margin-top: 14px; }
        .download-warning p { font-size: 12px; color: var(--muted); margin-bottom: 10px; }

        /* Settings Toggle */
        .settings-toggle { display: flex; align-items: center; justify-content: space-between; padding: 16px; background: var(--bg-secondary); border-radius: 8px; margin-bottom: 12px; }
        .settings-toggle-info h4 { font-size: 14px; font-weight: 600; margin-bottom: 4px; }
        .settings-toggle-info p { font-size: 12px; color: var(--muted); }
        .toggle-switch { position: relative; width: 50px; height: 26px; background: var(--border); border-radius: 13px; cursor: pointer; transition: background 0.3s; }
        .toggle-switch.active { background: var(--accent); }
        .toggle-switch::after { content: ''; position: absolute; top: 3px; left: 3px; width: 20px; height: 20px; background: #fff; border-radius: 50%; transition: transform 0.3s; }
        .toggle-switch.active::after { transform: translateX(24px); }

        /* Footer */
        .footer { border-top: 1px solid var(--border); background: var(--bg-secondary); margin-top: 30px; padding: 20px; }
        .footer-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 30px; max-width: 1100px; margin: 0 auto; }
        @media (max-width: 600px) { .footer-grid { grid-template-columns: 1fr; } }
        .footer-logo { font-family: 'Bebas Neue', sans-serif; font-size: 20px; letter-spacing: 2px; color: var(--accent); margin-bottom: 6px; }
        .footer-title { font-size: 13px; font-weight: 600; margin-bottom: 10px; }
        .footer-link { display: block; color: var(--muted); font-size: 12px; padding: 3px 0; cursor: pointer; transition: color 0.2s; }
        .footer-link:hover { color: var(--accent); }
        .footer-bottom { text-align: center; color: var(--muted); font-size: 11px; margin-top: 20px; padding-top: 16px; border-top: 1px solid var(--border); }

        /* Notification */
        .notification { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%) translateY(100px); background: var(--accent); color: #fff; padding: 12px 24px; border-radius: 6px; font-size: 13px; z-index: 1000; opacity: 0; transition: all 0.3s; }
        .notification.show { transform: translateX(-50%) translateY(0); opacity: 1; }

        /* Empty State */
        .empty-state { text-align: center; padding: 40px 20px; color: var(--muted); }
        
        /* Pagination for TMDB Results */
        .results-pagination { display: flex; justify-content: center; gap: 6px; margin-top: 12px; }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen"><div class="loading-logo">YSFLIX</div><div class="loading-bar"><div class="loading-bar-fill"></div></div></div>

    <!-- Navigation -->
    <nav class="nav-container">
        <div class="nav-inner">
            <span class="font-display logo" onclick="goHome()">YSFLIX</span>
            <div class="nav-actions">
                <div id="searchWrapper" class="search-wrapper"><input type="text" id="navSearch" class="search-input-nav" placeholder="Search..."><button class="nav-btn" onclick="closeNavSearch()">&times;</button></div>
                <button id="searchBtn" class="nav-btn" onclick="toggleNavSearch()"><svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg></button>
                <button id="menuBtn" class="nav-btn" onclick="toggleMenu()"><svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg></button>
            </div>
        </div>
    </nav>

    <!-- Menu Dropdown -->
    <div id="menuDropdown" class="menu-dropdown">
        <div class="menu-item active" data-section="home"><span>Home</span></div>
        <div class="menu-item" data-section="movies"><span>Movies</span></div>
        <div class="menu-item" data-section="series"><span>Series</span></div>
        <div class="menu-item" data-section="genres"><span>Genres / Tags</span></div>
        <div class="menu-item" data-section="settings"><span>Settings</span></div>
        <div id="authMenuItem" class="menu-item"><span id="authMenuText">Login</span></div>
        <div id="adminMenuItem" class="menu-item" style="display:none;"><span>Admin Panel</span></div>
        <div id="logoutMenuItem" class="menu-item" style="display:none;"><span>Logout</span></div>
    </div>

    <!-- Main Container -->
    <main class="main-container">
        <!-- Home Section -->
        <section id="homeSection" class="content-section active">
            <div class="section-header"><h2 class="section-title">MOVIES</h2><span class="view-all" data-section="movies">View All</span></div>
            <div id="homeMoviesGrid" class="movie-grid"></div>
            <div class="section-header" style="margin-top: 24px;"><h2 class="section-title">TV SERIES</h2><span class="view-all" data-section="series">View All</span></div>
            <div id="homeSeriesGrid" class="movie-grid"></div>
            <div class="genre-section"><div class="section-header"><h2 class="section-title">GENRES</h2></div><div id="homeGenreGrid" class="genre-grid"></div></div>
        </section>

        <!-- Movies Section -->
        <section id="moviesSection" class="content-section">
            <div class="section-header"><h2 class="section-title">MOVIES</h2></div>
            <div id="moviesGrid" class="movie-grid"></div>
            <div id="moviesPagination" class="pagination"></div>
        </section>

        <!-- Series Section -->
        <section id="seriesSection" class="content-section">
            <div class="section-header"><h2 class="section-title">TV SERIES</h2></div>
            <div id="seriesGrid" class="movie-grid"></div>
            <div id="seriesPagination" class="pagination"></div>
        </section>

        <!-- Genres Section -->
        <section id="genresSection" class="content-section">
            <div class="section-header"><h2 class="section-title">GENRES</h2></div>
            <div id="genresGridFull" class="genre-grid"></div>
            <div class="section-header" style="margin-top: 24px;"><h2 class="section-title">TAGS</h2></div>
            <div id="tagsGrid" class="tags-grid"></div>
        </section>

        <!-- Settings Section -->
        <section id="settingsSection" class="content-section">
            <div class="section-header"><h2 class="section-title">SETTINGS</h2></div>
            <div class="settings-toggle">
                <div class="settings-toggle-info"><h4>Show Download Links</h4><p>Enable to view download links in movie details</p></div>
                <div id="downloadToggle" class="toggle-switch"></div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-grid">
            <div><div class="footer-logo">YSFLIX</div><p style="color: var(--muted); font-size: 11px;">Your destination for movies and TV series.</p></div>
            <div><div class="footer-title">Quick Links</div><span class="footer-link" data-section="home">Home</span><span class="footer-link" data-section="movies">Movies</span><span class="footer-link" data-section="series">Series</span></div>
            <div><div class="footer-title">Support</div><span class="footer-link">Report a Bug</span><span class="footer-link">Request Movie</span></div>
        </div>
        <div class="footer-bottom">2025 YSFLIX. All rights reserved.</div>
    </footer>

    <!-- Login Modal -->
    <div id="loginModal" class="modal-backdrop">
        <div class="modal-content login-modal">
            <button class="admin-close" style="position:absolute;top:12px;right:12px;" onclick="closeLoginModal()">&times;</button>
            <h2 class="login-title">ADMIN LOGIN</h2>
            <p style="text-align:center;color:var(--muted);font-size:12px;margin-bottom:18px;">Enter your credentials</p>
            <div id="loginError" class="login-error">Invalid username or password</div>
            <form id="loginForm"><input type="text" id="loginUsername" class="login-input" placeholder="Username"><input type="password" id="loginPassword" class="login-input" placeholder="Password"><button type="submit" class="login-btn">Login</button></form>
        </div>
    </div>

    <!-- Admin Modal -->
    <div id="adminModal" class="modal-backdrop">
        <div class="modal-content admin-modal">
            <div class="admin-header"><h2 class="admin-title">ADMIN PANEL</h2><button class="admin-close" onclick="closeAdminModal()">&times;</button></div>
            <div class="admin-tabs">
                <div class="admin-tab active" data-tab="generator">TMDB Search</div>
                <div class="admin-tab" data-tab="saved">Saved</div>
                <div class="admin-tab" data-tab="manual">Manual Add</div>
                <div class="admin-tab" data-tab="manage">Manage</div>
                <div class="admin-tab" data-tab="backup">Backup</div>
            </div>

            <!-- TMDB Generator -->
            <div id="generatorSection" class="admin-panel-section active">
                <div class="tmdb-search">
                    <div class="tmdb-row">
                        <div class="tmdb-filter" style="flex:1;min-width:160px;"><label>Search</label><input type="text" id="searchQuery" class="tmdb-input" style="width:100%;" placeholder="Name..."></div>
                        <div class="tmdb-filter"><label>Type</label><select id="searchType" class="tmdb-select"><option value="all">All</option><option value="movie">Movie</option><option value="tv">Series</option></select></div>
                        <div class="tmdb-filter"><label>Year</label><select id="searchYear" class="tmdb-select"><option value="">All</option></select></div>
                        <div class="tmdb-filter"><label>Genre</label><select id="searchGenre" class="tmdb-select"><option value="">All</option></select></div>
                        <div class="tmdb-filter"><label>Count</label><input type="number" id="searchCount" class="tmdb-input" value="20" min="1" style="width:65px;"></div>
                    </div>
                    <div class="tmdb-row" style="margin-top:10px;">
                        <button class="tmdb-btn" onclick="searchTMDB()">Search</button>
                        <button class="tmdb-btn secondary" onclick="discoverTMDB()">Discover</button>
                    </div>
                </div>

                <!-- Results -->
                <div id="resultsContainer" class="results-container" style="display:none;">
                    <div class="results-header" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
                        <span style="font-size:13px;font-weight:600;">Results: <span id="resultCount">0</span></span>
                        <div style="display:flex;gap:6px;">
                            <button class="tmdb-btn secondary" onclick="selectAllResults()">Select All</button>
                            <button class="tmdb-btn success" onclick="importAllResults()">Import All</button>
                        </div>
                    </div>
                    <div id="resultsGrid" class="results-grid"></div>
                    <div id="resultsPagination" class="results-pagination"></div>
                </div>

                <!-- Selected Bar -->
                <div id="selectedBar" class="selected-bar">
                    <div class="selected-bar-left"><span class="selected-count"><span id="selectedCount">0</span> selected</span><button class="tmdb-btn secondary" onclick="clearSelection()">Clear</button></div>
                    <button class="tmdb-btn success" onclick="importSelected()">Import Selected</button>
                </div>

                <!-- Movie Detail (Hidden initially) -->
                <div id="movieDetail" class="movie-detail">
                    <div class="movie-detail-header">
                        <img id="detailPoster" class="movie-detail-poster" src="" alt="">
                        <div class="movie-detail-info">
                            <h3 id="detailTitle"></h3>
                            <div id="detailMeta" style="font-size:12px;color:var(--muted);line-height:1.6;"></div>
                        </div>
                    </div>
                    
                    <!-- Season Episode for Series -->
                    <div id="seasonEpisodeSection" class="season-episode-section">
                        <div class="season-episode-row">
                            <div class="se-select"><label>Season:</label><select id="seasonSelect" onchange="updateEpisodes()"></select></div>
                            <div class="se-select"><label>Episode:</label><select id="episodeSelect" onchange="showLinkSection()"></select></div>
                        </div>
                    </div>

                    <!-- Servers -->
                    <div id="serversSection" class="servers-section">
                        <div class="quick-servers">
                            <button class="quick-server-btn" onclick="addQuickServer('Megaup')">+ Megaup</button>
                            <button class="quick-server-btn" onclick="addQuickServer('Google Drive')">+ GDrive</button>
                            <button class="quick-server-btn" onclick="addQuickServer('Yoteshin')">+ Yoteshin</button>
                        </div>
                        <div id="detailServersList" class="servers-list"></div>
                        <button class="add-server-btn" onclick="addServerRow()">+ Add Server</button>
                    </div>

                    <div style="display:flex;gap:10px;margin-top:14px;">
                        <button class="btn-primary" onclick="saveMovieDetail()" style="flex:1;">Save to Library</button>
                        <button class="btn-secondary" onclick="downloadMovieJSON()">JSON</button>
                    </div>
                </div>
            </div>

            <!-- Saved Movies -->
            <div id="savedSection" class="admin-panel-section"><p style="font-size:12px;color:var(--muted);margin-bottom:12px;">Auto-saved from TMDB Search</p><div id="savedMoviesList" class="saved-list"></div></div>

            <!-- Manual Add -->
            <div id="manualSection" class="admin-panel-section">
                <form id="manualForm" class="admin-form">
                    <div class="form-group"><label class="form-label">Title *</label><input type="text" id="manualTitle" class="form-input" required></div>
                    <div class="form-group"><label class="form-label">Year</label><input type="number" id="manualYear" class="form-input" placeholder="2025"></div>
                    <div class="form-group"><label class="form-label">Rating</label><input type="number" id="manualRating" class="form-input" step="0.1" placeholder="7.5"></div>
                    <div class="form-group"><label class="form-label">Duration</label><input type="text" id="manualDuration" class="form-input" placeholder="120 min"></div>
                    <div class="form-group"><label class="form-label">Type</label><select id="manualType" class="form-select" onchange="toggleManualSeasons()"><option value="movie">Movie</option><option value="series">Series</option></select></div>
                    <div class="form-group"><label class="form-label">Quality</label><input type="text" id="manualQuality" class="form-input" placeholder="WEB-DL" list="qualityList"><datalist id="qualityList"><option value="WEB-DL"><option value="BluRay"><option value="HDRip"></datalist></div>
                    <div class="form-group full-width"><label class="form-label">Poster URL</label><input type="url" id="manualPoster" class="form-input" placeholder="https://..."></div>
                    <div class="form-group full-width"><label class="form-label">Genres (comma separated)</label><input type="text" id="manualGenres" class="form-input" placeholder="Action, Drama"></div>
                    <div class="form-group full-width"><label class="form-label">Synopsis</label><textarea id="manualSynopsis" class="form-textarea"></textarea></div>
                    
                    <!-- Series Specific: Seasons/Episodes UI for Manual Add -->
                    <div id="manualSeasonsSection" class="form-group full-width" style="display:none; border-top:1px solid var(--border); padding-top:12px; margin-top:8px;">
                        <label class="form-label">Series Links (Add per Episode)</label>
                        <div style="display:flex; gap:12px; margin-bottom:10px;">
                            <div class="se-select"><label>Season:</label><select id="manualSeasonSelect" onchange="updateManualEpisodes()"></select></div>
                            <div class="se-select"><label>Episode:</label><select id="manualEpisodeSelect" onchange="loadManualEpisodeLinks()"></select></div>
                        </div>
                        <div id="manualEpisodeLinks" class="servers-list"></div>
                        <button type="button" class="add-server-btn" onclick="addManualServerRow()">+ Add Link to this Episode</button>
                    </div>

                    <div class="form-group full-width" style="display:flex;gap:10px;margin-top:8px;">
                        <button type="submit" class="btn-primary" style="flex:1;">Save Movie</button>
                        <button type="button" class="btn-secondary" onclick="resetManualForm()">Clear</button>
                    </div>
                </form>
            </div>

            <!-- Manage -->
            <div id="manageSection" class="admin-panel-section">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
                    <span style="font-size:12px;color:var(--muted);"><span id="manageCount">0</span> movies total</span>
                    <input type="text" id="manageSearch" class="form-input" placeholder="Search..." style="width:140px;padding:7px 10px;">
                </div>
                <div id="manageList" class="saved-list" style="max-height:360px;"></div>
            </div>

            <!-- Backup -->
            <div id="backupSection" class="admin-panel-section">
                <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:14px;">
                    <div style="background:var(--bg-secondary);border-radius:8px;padding:18px;text-align:center;">
                        <h4 style="font-size:13px;margin-bottom:8px;">Export All</h4>
                        <p style="font-size:11px;color:var(--muted);margin-bottom:12px;">Download all movies as JSON</p>
                        <button class="btn-primary" onclick="exportAll()" style="width:100%;">Export JSON</button>
                    </div>
                    <div style="background:var(--bg-secondary);border-radius:8px;padding:18px;text-align:center;">
                        <h4 style="font-size:13px;margin-bottom:8px;">Import</h4>
                        <p style="font-size:11px;color:var(--muted);margin-bottom:12px;">Restore from JSON file</p>
                        <input type="file" id="importFile" accept=".json" style="display:none;" onchange="importData(event)">
                        <button class="btn-primary" onclick="document.getElementById('importFile').click()" style="width:100%;">Import JSON</button>
                    </div>
                </div>
                <div style="margin-top:14px;padding:12px;background:rgba(198,40,40,0.1);border:1px solid #c62828;border-radius:6px;">
                    <h4 style="font-size:12px;color:#c62828;margin-bottom:6px;">Danger Zone</h4>
                    <p style="font-size:10px;color:var(--muted);margin-bottom:10px;">Delete all movies permanently</p>
                    <button class="btn-danger" onclick="clearAllData()">Clear All Data</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Movie Modal -->
    <div id="movieModal" class="modal-backdrop">
        <div class="modal-content" style="padding:18px;">
            <button class="admin-close" style="position:absolute;top:12px;right:12px;background:rgba(0,0,0,0.5);border-radius:50%;width:30px;height:30px;" onclick="closeMovieModal()">&times;</button>
            <div id="movieModalContent"></div>
        </div>
    </div>

    <div id="notification" class="notification"></div>

    <script>
        // ================== CONFIG ==================
        var TMDB_API_KEY = "2e928cd76f7f5ae46f6e022f5dcc2612";
        var TMDB_BASE = "https://api.themoviedb.org/3";
        var TMDB_IMG = "https://image.tmdb.org/t/p/w500";
        var VALID_USERNAME = "Admin8676";
        var VALID_PASSWORD = "Admin8676";
        var ITEMS_PER_PAGE = 30;

        // ================== STATE ==================
        var movies = [];
        var isLoggedIn = false;
        var showDownloads = false;
        var currentSection = 'home';
        var currentPage = 1;
        var searchResults = [];
        var selectedResults = [];
        var currentDetail = null;
        var detailServers = [];
        var editingMovieId = null;
        var currentSearchPage = 1;
        var totalSearchPages = 1;
        var lastSearchUrl = '';

        // ================== DATA ==================
        var genres = [
            { name: "Action", icon: "âš¡" }, { name: "Adventure", icon: "ðŸ—º" }, { name: "Comedy", icon: "ðŸŽ­" },
            { name: "Crime", icon: "ðŸ”«" }, { name: "Drama", icon: "ðŸŽ¬" }, { name: "Fantasy", icon: "ðŸ§™" },
            { name: "Horror", icon: "ðŸ‘»" }, { name: "Mystery", icon: "ðŸ”" }, { name: "Romance", icon: "ðŸ’•" },
            { name: "Sci-Fi", icon: "ðŸš€" }, { name: "Thriller", icon: "ðŸ”ª" }, { name: "Animation", icon: "ðŸŽ¨" }
        ];
        var tags = [{ name: "Featured" }, { name: "Trending" }, { name: "New Release" }, { name: "Top Rated" }, { name: "Myanmar Sub" }];
        var TMDB_GENRES = [
            { id: 28, name: "Action" }, { id: 12, name: "Adventure" }, { id: 16, name: "Animation" },
            { id: 35, name: "Comedy" }, { id: 80, name: "Crime" }, { id: 99, name: "Documentary" },
            { id: 18, name: "Drama" }, { id: 10751, name: "Family" }, { id: 14, name: "Fantasy" },
            { id: 36, name: "History" }, { id: 27, name: "Horror" }, { id: 10402, name: "Music" },
            { id: 9648, name: "Mystery" }, { id: 10749, name: "Romance" }, { id: 878, name: "Sci-Fi" },
            { id: 10770, name: "TV Movie" }, { id: 53, name: "Thriller" }, { id: 10752, name: "War" }, { id: 37, name: "Western" }
        ];

        // ================== INIT ==================
        function init() { loadSettings(); loadMovies(); initFilters(); setupEvents(); renderAll(); updateAuthUI(); setTimeout(function() { document.getElementById('loadingScreen').classList.add('hidden'); }, 700); }
        function loadSettings() { isLoggedIn = localStorage.getItem('ysflix_logged_in') === 'true'; showDownloads = localStorage.getItem('ysflix_show_downloads') === 'true'; updateDownloadToggle(); }
        function loadMovies() { var stored = localStorage.getItem('ysflix_movies'); if (stored) { try { movies = JSON.parse(stored); } catch (e) { movies = []; } } }
        function saveMovies() { localStorage.setItem('ysflix_movies', JSON.stringify(movies)); }
        function initFilters() {
            var yearSel = document.getElementById('searchYear'); var year = new Date().getFullYear();
            for (var y = year + 1; y >= 1900; y--) { yearSel.innerHTML += '<option value="' + y + '">' + y + '</option>'; }
            var genreSel = document.getElementById('searchGenre'); TMDB_GENRES.forEach(function(g) { genreSel.innerHTML += '<option value="' + g.id + '">' + g.name + '</option>'; });
            var ms = document.getElementById('manualSeasonSelect');
            for(var i=1; i<=50; i++) ms.innerHTML += '<option value="'+i+'">Season '+i+'</option>';
            updateManualEpisodes();
        }
        function updateManualEpisodes(){
            var epSel = document.getElementById('manualEpisodeSelect');
            epSel.innerHTML = '';
            for(var i=1; i<=30; i++) epSel.innerHTML += '<option value="'+i+'">Episode '+i+'</option>';
            loadManualEpisodeLinks();
        }
        function loadManualEpisodeLinks(){ renderManualEpisodeLinks(); }
        function addManualServerRow(){ addServerRow(); renderManualEpisodeLinks(); }
        function renderManualEpisodeLinks(){
             var list = document.getElementById('manualEpisodeLinks');
             list.innerHTML = detailServers.map(function(s, i){
                return '<div class="server-item">' +
                    '<input type="text" class="server-input" value="' + s.server + '" placeholder="Server" onchange="updateDetailServer(' + i + ', \'server\', this.value)" style="width:80px;">' +
                    '<input type="text" class="server-input" value="' + s.size + '" placeholder="Size" onchange="updateDetailServer(' + i + ', \'size\', this.value)" style="width:60px;">' +
                    '<input type="url" class="server-input" value="' + (s.url || '') + '" placeholder="URL" onchange="updateDetailServer(' + i + ', \'url\', this.value)" style="flex:1;">' +
                    '<button class="server-remove" onclick="removeDetailServer(' + i + ')">&times;</button>' +
                '</div>';
             }).join('');
             if(detailServers.length === 0) list.innerHTML = '<p style="font-size:11px;color:var(--muted);padding:10px;">No links added for this episode.</p>';
        }
        function toggleManualSeasons(){
            var type = document.getElementById('manualType').value;
            document.getElementById('manualSeasonsSection').style.display = type === 'series' ? 'block' : 'none';
        }

        // ================== EVENTS ==================
        function setupEvents() {
            document.querySelectorAll('.menu-item[data-section]').forEach(function(item) { item.addEventListener('click', function() { navigateTo(this.dataset.section); }); });
            document.querySelectorAll('.view-all[data-section]').forEach(function(item) { item.addEventListener('click', function() { navigateTo(this.dataset.section); }); });
            document.querySelectorAll('.footer-link[data-section]').forEach(function(item) { item.addEventListener('click', function() { navigateTo(this.dataset.section); }); });
            document.querySelectorAll('.admin-tab[data-tab]').forEach(function(tab) { tab.addEventListener('click', function() { switchAdminTab(this.dataset.tab); }); });
            document.getElementById('authMenuItem').addEventListener('click', function() { closeMenu(); if (isLoggedIn) { openAdminModal(); } else { document.getElementById('loginModal').classList.add('active'); } });
            document.getElementById('adminMenuItem').addEventListener('click', function() { closeMenu(); openAdminModal(); });
            document.getElementById('logoutMenuItem').addEventListener('click', handleLogout);
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('manualForm').addEventListener('submit', handleManualSubmit);
            document.getElementById('manageSearch').addEventListener('input', renderManageList);
            document.getElementById('downloadToggle').addEventListener('click', toggleDownloads);
            document.getElementById('navSearch').addEventListener('input', function(e) {
                var q = e.target.value.toLowerCase();
                if (q.length > 0) {
                    var filtered = movies.filter(function(m) { return m.title.toLowerCase().indexOf(q) !== -1; });
                    renderHomeMovies(filtered.filter(function(m) { return m.type === 'movie'; }).slice(0, 6));
                    renderHomeSeries(filtered.filter(function(m) { return m.type === 'series'; }).slice(0, 6));
                } else { renderAll(); }
            });
            document.getElementById('loginModal').addEventListener('click', function(e) { if (e.target === this) closeLoginModal(); });
            document.getElementById('adminModal').addEventListener('click', function(e) { if (e.target === this) closeAdminModal(); });
            document.getElementById('movieModal').addEventListener('click', function(e) { if (e.target === this) closeMovieModal(); });
            document.addEventListener('keydown', function(e) { if (e.key === 'Escape') { closeLoginModal(); closeAdminModal(); closeMovieModal(); closeMenu(); } });
            document.addEventListener('click', function(e) {
                var menu = document.getElementById('menuDropdown'); var menuBtn = document.getElementById('menuBtn');
                if (!menu.contains(e.target) && !menuBtn.contains(e.target)) { closeMenu(); }
            });
        }

        // ================== NAVIGATION ==================
        function goHome() { navigateTo('home'); }
        function toggleNavSearch() { document.getElementById('searchWrapper').classList.add('active'); document.getElementById('searchBtn').style.display = 'none'; document.getElementById('navSearch').focus(); }
        function closeNavSearch() { document.getElementById('searchWrapper').classList.remove('active'); document.getElementById('searchBtn').style.display = 'flex'; document.getElementById('navSearch').value = ''; renderAll(); }
        function toggleMenu() { document.getElementById('menuDropdown').classList.toggle('active'); }
        function closeMenu() { document.getElementById('menuDropdown').classList.remove('active'); }
        function navigateTo(section) {
            currentSection = section; currentPage = 1; closeMenu();
            document.querySelectorAll('.menu-item[data-section]').forEach(function(item) { item.classList.toggle('active', item.dataset.section === section); });
            document.querySelectorAll('.content-section').forEach(function(s) { s.classList.remove('active'); });
            document.getElementById(section + 'Section').classList.add('active');
            if (section === 'home') renderHome();
            else if (section === 'movies') renderMoviesPage();
            else if (section === 'series') renderSeriesPage();
            else if (section === 'genres') renderGenresPage();
            window.scrollTo(0, 0);
        }

        // ================== AUTH ==================
        function handleLogin(e) {
            e.preventDefault();
            var user = document.getElementById('loginUsername').value; var pass = document.getElementById('loginPassword').value;
            if (user === VALID_USERNAME && pass === VALID_PASSWORD) {
                isLoggedIn = true; localStorage.setItem('ysflix_logged_in', 'true');
                closeLoginModal(); updateAuthUI(); showNotification('Login successful!'); openAdminModal();
            } else { document.getElementById('loginError').style.display = 'block'; }
        }
        function closeLoginModal() { document.getElementById('loginModal').classList.remove('active'); document.getElementById('loginError').style.display = 'none'; document.getElementById('loginForm').reset(); }
        function handleLogout() { isLoggedIn = false; localStorage.removeItem('ysflix_logged_in'); updateAuthUI(); closeMenu(); showNotification('Logged out!'); }
        function updateAuthUI() {
            document.getElementById('authMenuText').textContent = isLoggedIn ? 'Admin' : 'Login';
            document.getElementById('adminMenuItem').style.display = isLoggedIn ? 'flex' : 'none';
            document.getElementById('logoutMenuItem').style.display = isLoggedIn ? 'flex' : 'none';
        }
        function toggleDownloads() { showDownloads = !showDownloads; localStorage.setItem('ysflix_show_downloads', showDownloads); updateDownloadToggle(); showNotification(showDownloads ? 'Download links enabled' : 'Download links hidden'); }
        function updateDownloadToggle() { document.getElementById('downloadToggle').classList.toggle('active', showDownloads); }

        // ================== ADMIN ==================
        function openAdminModal() { if (!isLoggedIn) { document.getElementById('loginModal').classList.add('active'); return; } document.getElementById('adminModal').classList.add('active'); renderSavedList(); renderManageList(); }
        function closeAdminModal() { document.getElementById('adminModal').classList.remove('active'); editingMovieId = null; }
        function switchAdminTab(tab) {
            document.querySelectorAll('.admin-tab').forEach(function(t) { t.classList.remove('active'); });
            document.querySelectorAll('.admin-panel-section').forEach(function(s) { s.classList.remove('active'); });
            document.querySelector('.admin-tab[data-tab="' + tab + '"]').classList.add('active');
            document.getElementById(tab + 'Section').classList.add('active');
            if (tab === 'saved' || tab === 'manage') renderManageList();
            if (tab === 'manual') toggleManualSeasons();
        }

        // ================== TMDB ==================
        async function searchTMDB() {
            var query = document.getElementById('searchQuery').value.trim(); if (!query) { showNotification('Enter search query'); return; }
            var type = document.getElementById('searchType').value;
            showNotification('Searching...');
            try {
                lastSearchUrl = TMDB_BASE + '/search/' + (type === 'all' ? 'multi' : type) + '?api_key=' + TMDB_API_KEY + '&query=' + encodeURIComponent(query);
                await fetchSearchPage(1);
            } catch (err) { showNotification('Search failed'); }
        }

        async function discoverTMDB() {
            var type = document.getElementById('searchType').value; var year = document.getElementById('searchYear').value; var genre = document.getElementById('searchGenre').value;
            showNotification('Discovering...');
            try {
                var mediaType = type === 'tv' ? 'tv' : 'movie';
                lastSearchUrl = TMDB_BASE + '/discover/' + mediaType + '?api_key=' + TMDB_API_KEY + '&sort_by=popularity.desc';
                if (year) lastSearchUrl += '&year=' + year; if (genre) lastSearchUrl += '&with_genres=' + genre;
                await fetchSearchPage(1);
            } catch (err) { showNotification('Discover failed'); }
        }

        async function fetchSearchPage(page) {
            var url = lastSearchUrl + '&page=' + page;
            var res = await fetch(url); var data = await res.json();
            searchResults = data.results || [];
            var type = document.getElementById('searchType').value;
            if (type === 'all') { searchResults = searchResults.filter(function(r) { return r.media_type === 'movie' || r.media_type === 'tv'; }); }
            else { searchResults = searchResults.map(function(r) { r.media_type = type; return r; }); }
            
            currentSearchPage = data.page || 1;
            totalSearchPages = data.total_pages || 1;
            
            renderResults();
            showNotification('Found ' + (data.total_results || searchResults.length) + ' results');
        }

        function renderResults() {
            document.getElementById('resultCount').textContent = searchResults.length;
            var grid = document.getElementById('resultsGrid');
            grid.innerHTML = searchResults.map(function(item, i) {
                var title = item.title || item.name || 'Unknown';
                var year = (item.release_date || item.first_air_date || '').split('-')[0] || 'N/A';
                var poster = item.poster_path ? TMDB_IMG + item.poster_path : '';
                var isSelected = selectedResults.indexOf(i) !== -1;
                var typeLabel = item.media_type === 'tv' ? 'Series' : 'Movie';
                return '<div class="result-card' + (isSelected ? ' selected' : '') + '" data-index="' + i + '">' +
                    '<div class="result-poster">' + (poster ? '<img src="' + poster + '" loading="lazy">' : '<div style="display:flex;align-items:center;justify-content:center;height:100%;color:#666;font-size:11px;">No Image</div>') +
                    '<div class="result-overlay"><span>Select</span></div><div class="result-check">&#10003;</div></div>' +
                    '<div class="result-info"><div class="result-title">' + title + '</div><div class="result-meta">' + typeLabel + ' | ' + year + '</div></div></div>';
            }).join('');
            grid.querySelectorAll('.result-card').forEach(function(card) { card.addEventListener('click', function() { toggleSelect(parseInt(this.dataset.index)); }); });
            document.getElementById('resultsContainer').style.display = 'block';
            updateSelectedBar();
            renderResultsPagination();
        }

        function renderResultsPagination(){
            var pag = document.getElementById('resultsPagination');
            if(totalSearchPages <= 1) { pag.innerHTML = ''; return; }
            var html = '';
            if(currentSearchPage > 1) html += '<button class="page-btn" onclick="loadPrevPage()">&larr;</button>';
            html += '<span style="color:var(--muted);font-size:11px;"> Page ' + currentSearchPage + ' of ' + totalSearchPages + ' </span>';
            if(currentSearchPage < totalSearchPages) html += '<button class="page-btn" onclick="loadNextPage()">Next &rarr;</button>';
            pag.innerHTML = html;
        }
        async function loadNextPage(){ await fetchSearchPage(currentSearchPage + 1); }
        async function loadPrevPage(){ await fetchSearchPage(currentSearchPage - 1); }

        function toggleSelect(index) { var idx = selectedResults.indexOf(index); if (idx === -1) selectedResults.push(index); else selectedResults.splice(idx, 1); renderResults(); }
        function selectAllResults() { selectedResults = searchResults.map(function(_, i) { return i; }); renderResults(); }
        function clearSelection() { selectedResults = []; renderResults(); }
        function updateSelectedBar() { var bar = document.getElementById('selectedBar'); document.getElementById('selectedCount').textContent = selectedResults.length; bar.classList.toggle('active', selectedResults.length > 0); }

        async function importAllResults() {
            if (searchResults.length === 0) { showNotification('No results to import'); return; }
            showNotification('Importing all ' + searchResults.length + ' items...');
            for (var i = 0; i < searchResults.length; i++) { await fetchAndSave(searchResults[i].id, searchResults[i].media_type); }
            showNotification('Imported all ' + searchResults.length + ' items!');
            selectedResults = []; renderResults(); renderAll(); renderSavedList(); renderManageList();
        }
        async function importSelected() {
            if (selectedResults.length === 0) { showNotification('No items selected'); return; }
            showNotification('Importing ' + selectedResults.length + ' items...');
            for (var i = 0; i < selectedResults.length; i++) { await fetchAndSave(searchResults[selectedResults[i]].id, searchResults[selectedResults[i]].media_type); }
            showNotification('Imported ' + selectedResults.length + ' items!');
            selectedResults = []; renderResults(); renderAll(); renderSavedList(); renderManageList();
        }

        async function fetchAndSave(id, type) {
            try {
                var res = await fetch(TMDB_BASE + '/' + type + '/' + id + '?api_key=' + TMDB_API_KEY); var data = await res.json();
                var creditsRes = await fetch(TMDB_BASE + '/' + type + '/' + id + '/credits?api_key=' + TMDB_API_KEY); var credits = await creditsRes.json();
                
                var seasonsData = [];
                if (type === 'tv' && data.seasons) {
                    seasonsData = data.seasons.filter(s=>s.season_number > 0).map(s => {
                        return {
                            season_number: s.season_number, episode_count: s.episode_count,
                            episodes: Array.from({length: s.episode_count}, (_, i) => ({ episode_number: i+1, downloads: [] }))
                        };
                    });
                }

                var movie = {
                    id: Date.now() + Math.random().toString(36).substr(2, 9), tmdbId: data.id, title: data.title || data.name,
                    year: (data.release_date || data.first_air_date || '').split('-')[0] || 'N/A', rating: data.vote_average || 0,
                    duration: type === 'tv' ? (data.episode_run_time && data.episode_run_time[0] ? data.episode_run_time[0] + ' min/ep' : 'N/A') : (data.runtime ? data.runtime + ' min' : 'N/A'),
                    genres: (data.genres || []).map(function(g) { return g.name; }), type: type === 'tv' ? 'series' : 'movie', quality: 'WEB-DL',
                    poster: data.poster_path ? TMDB_IMG + data.poster_path : '', director: '', releaseDate: data.release_date || data.first_air_date || '',
                    synopsis: data.overview || '', cast: (credits.cast || []).slice(0, 6).map(function(c) { return { name: c.name, avatar: c.profile_path ? TMDB_IMG + c.profile_path : '' }; }),
                    downloads: (type === 'movie' ? [] : undefined),
                    seasons: (type === 'tv' ? seasonsData : undefined),
                    subtitle: 'Myanmar Subtitle'
                };
                if (credits.crew) { var dir = credits.crew.find(function(c) { return c.job === 'Director'; }); if (dir) movie.director = dir.name; }
                movies.unshift(movie);
            } catch (err) { console.log('Failed:', id); }
        }

        // ================== DETAIL ==================
        function showDetail(index) { fetchDetail(searchResults[index].id, searchResults[index].media_type); }
        async function fetchDetail(id, type) {
            showNotification('Loading...');
            try {
                var res = await fetch(TMDB_BASE + '/' + type + '/' + id + '?api_key=' + TMDB_API_KEY); var data = await res.json();
                var creditsRes = await fetch(TMDB_BASE + '/' + type + '/' + id + '/credits?api_key=' + TMDB_API_KEY); var credits = await creditsRes.json();
                
                var seasonsData = [];
                if (type === 'tv' && data.seasons) {
                    seasonsData = data.seasons.filter(s=>s.season_number > 0).map(s => {
                        return { season_number: s.season_number, episode_count: s.episode_count, episodes: Array.from({length: s.episode_count}, (_, i) => ({ episode_number: i+1, downloads: [] })) };
                    });
                }

                currentDetail = {
                    id: Date.now() + Math.random().toString(36).substr(2, 9), tmdbId: data.id, title: data.title || data.name,
                    year: (data.release_date || data.first_air_date || '').split('-')[0] || 'N/A', rating: data.vote_average || 0,
                    duration: type === 'tv' ? (data.episode_run_time && data.episode_run_time[0] ? data.episode_run_time[0] + ' min/ep' : 'N/A') : (data.runtime ? data.runtime + ' min' : 'N/A'),
                    genres: (data.genres || []).map(function(g) { return g.name; }), type: type === 'tv' ? 'series' : 'movie', quality: 'WEB-DL',
                    poster: data.poster_path ? TMDB_IMG + data.poster_path : '', director: '', releaseDate: data.release_date || data.first_air_date || '',
                    synopsis: data.overview || '', cast: (credits.cast || []).slice(0, 6).map(function(c) { return { name: c.name, avatar: c.profile_path ? TMDB_IMG + c.profile_path : '' }; }),
                    downloads: (type === 'movie' ? [] : undefined), seasons: (type === 'tv' ? seasonsData : undefined), subtitle: 'Myanmar Subtitle'
                };
                if (credits.crew) { var dir = credits.crew.find(function(c) { return c.job === 'Director'; }); if (dir) currentDetail.director = dir.name; }
                displayDetail();
            } catch (err) { showNotification('Failed to load'); }
        }

        function displayDetail() {
            var d = currentDetail;
            document.getElementById('detailPoster').src = d.poster || 'https://picsum.photos/seed/p/200/300';
            document.getElementById('detailTitle').textContent = d.title;
            document.getElementById('detailMeta').innerHTML = '<p>' + d.year + ' | ' + d.rating.toFixed(1) + ' | ' + d.duration + '</p><p>' + (d.genres || []).join(', ') + '</p>' + (d.type === 'series' ? '<p>Seasons: ' + (d.seasons ? d.seasons.length : 0) + '</p>' : '') + '<p style="margin-top:8px;">' + (d.synopsis || '').substring(0, 120) + '...</p>';
            
            var seSection = document.getElementById('seasonEpisodeSection');
            var serversSection = document.getElementById('serversSection');

            if (d.type === 'series' && d.seasons && d.seasons.length > 0) {
                seSection.classList.add('active'); serversSection.classList.remove('active');
                var seasonSel = document.getElementById('seasonSelect');
                seasonSel.innerHTML = d.seasons.map(s => '<option value="'+s.season_number+'">Season '+s.season_number+'</option>').join('');
                updateEpisodes();
            } else { seSection.classList.remove('active'); serversSection.classList.add('active'); }
            
            detailServers = []; renderDetailServers();
            document.getElementById('movieDetail').classList.add('active');
        }

        function updateEpisodes() {
            var seasonNum = parseInt(document.getElementById('seasonSelect').value); var d = currentDetail;
            if (d && d.seasons) {
                var season = d.seasons.find(s => s.season_number === seasonNum); var epSel = document.getElementById('episodeSelect');
                if (season) { epSel.innerHTML = season.episodes.map(ep => '<option value="'+ep.episode_number+'">Episode '+ep.episode_number+'</option>').join(''); }
            }
            document.getElementById('serversSection').classList.remove('active');
        }

        function showLinkSection() {
            document.getElementById('serversSection').classList.add('active');
            var seasonNum = parseInt(document.getElementById('seasonSelect').value); var epNum = parseInt(document.getElementById('episodeSelect').value); var d = currentDetail;
            if(d && d.seasons){
                var season = d.seasons.find(s=>s.season_number === seasonNum);
                if(season){
                    var episode = season.episodes.find(ep=>ep.episode_number === epNum);
                    detailServers = episode ? (episode.downloads || []) : [];
                } else { detailServers = []; }
            } else { detailServers = []; }
            renderDetailServers();
        }

        function addQuickServer(name) { if (!detailServers.find(s => s.server === name)) { detailServers.push({ server: name, size: '', quality: 'WEB-DL', resolution: '1080p', url: '' }); renderDetailServers(); } }
        function addServerRow() { detailServers.push({ server: '', size: '', quality: 'WEB-DL', resolution: '1080p', url: '' }); renderDetailServers(); }
        function renderDetailServers() {
            var list = document.getElementById('detailServersList');
            list.innerHTML = detailServers.map(function(s, i) {
                return '<div class="server-item">' +
                    '<input type="text" class="server-input" value="' + s.server + '" placeholder="Server" onchange="updateDetailServer(' + i + ', \'server\', this.value)" style="width:80px;">' +
                    '<input type="text" class="server-input" value="' + s.size + '" placeholder="Size" onchange="updateDetailServer(' + i + ', \'size\', this.value)" style="width:60px;">' +
                    '<select class="server-input" onchange="updateDetailServer(' + i + ', \'quality\', this.value)" style="width:70px;"><option value="WEB-DL"' + (s.quality === 'WEB-DL' ? ' selected' : '') + '>WEB-DL</option><option value="BluRay">BluRay</option></select>' +
                    '<input type="url" class="server-input" value="' + (s.url || '') + '" placeholder="URL" onchange="updateDetailServer(' + i + ', \'url\', this.value)" style="flex:1;">' +
                    '<button class="server-remove" onclick="removeDetailServer(' + i + ')">&times;</button>' +
                '</div>';
            }).join('');
        }
        function updateDetailServer(index, field, value) { detailServers[index][field] = value; }
        function removeDetailServer(index) { detailServers.splice(index, 1); renderDetailServers(); }

        function saveMovieDetail() {
            if (!currentDetail) return;
            if(currentDetail.type === 'series'){
                var seasonNum = parseInt(document.getElementById('seasonSelect').value); var epNum = parseInt(document.getElementById('episodeSelect').value);
                var season = currentDetail.seasons.find(s=>s.season_number === seasonNum);
                if(season){
                    var episode = season.episodes.find(ep=>ep.episode_number === epNum);
                    if(episode) episode.downloads = detailServers.filter(s => s.server);
                }
            } else { currentDetail.downloads = detailServers.filter(s => s.server); }
            
            var existingIndex = movies.findIndex(m => m.id === currentDetail.id);
            if(existingIndex > -1) movies[existingIndex] = currentDetail;
            else movies.unshift(currentDetail);
            
            saveMovies(); renderAll(); renderSavedList(); renderManageList();
            showNotification('Saved: ' + currentDetail.title);
            currentDetail = null; detailServers = [];
            document.getElementById('movieDetail').classList.remove('active');
        }
        function downloadMovieJSON() {
            if (!currentDetail) return;
            var json = JSON.stringify(currentDetail, null, 2); var blob = new Blob([json], { type: 'application/json' }); var url = URL.createObjectURL(blob);
            var a = document.createElement('a'); a.href = url; a.download = (currentDetail.title || 'movie').replace(/[^a-z0-9]/gi, '_') + '.json'; a.click();
            URL.revokeObjectURL(url);
        }

        // ================== MANUAL ==================
        function handleManualSubmit(e) {
            e.preventDefault();
            var type = document.getElementById('manualType').value;
            var movie = {
                id: editingMovieId || Date.now() + Math.random().toString(36).substr(2, 9),
                title: document.getElementById('manualTitle').value,
                year: parseInt(document.getElementById('manualYear').value) || new Date().getFullYear(),
                rating: parseFloat(document.getElementById('manualRating').value) || 0,
                duration: document.getElementById('manualDuration').value || 'N/A',
                genres: document.getElementById('manualGenres').value.split(',').map(function(g) { return g.trim(); }).filter(Boolean),
                type: type, quality: document.getElementById('manualQuality').value || 'WEB-DL',
                poster: document.getElementById('manualPoster').value || 'https://picsum.photos/seed/' + Date.now() + '/400/600',
                synopsis: document.getElementById('manualSynopsis').value, cast: [], subtitle: 'Myanmar Subtitle'
            };

            if(type === 'series'){
                var seasonNum = parseInt(document.getElementById('manualSeasonSelect').value); var epNum = parseInt(document.getElementById('manualEpisodeSelect').value);
                if(!movie.seasons) movie.seasons = [];
                var season = movie.seasons.find(s=>s.season_number === seasonNum);
                if(!season){ season = { season_number: seasonNum, episodes: [] }; movie.seasons.push(season); }
                var episode = season.episodes.find(ep=>ep.episode_number === epNum);
                if(!episode){ episode = { episode_number: epNum, downloads: [] }; season.episodes.push(episode); }
                episode.downloads = detailServers.filter(s => s.server);
            } else { movie.downloads = detailServers.filter(s => s.server); }

            if (editingMovieId) movies = movies.filter(m => m.id !== editingMovieId);
            movies.unshift(movie); saveMovies(); renderAll(); renderManageList(); resetManualForm(); showNotification('Saved!');
        }
        function resetManualForm() { document.getElementById('manualForm').reset(); editingMovieId = null; detailServers = []; renderManualEpisodeLinks(); toggleManualSeasons(); }

        // ================== MANAGE ==================
        function renderSavedList() {
            var list = document.getElementById('savedMoviesList'); var saved = movies.filter(m => m.tmdbId);
            if (saved.length === 0) { list.innerHTML = '<div style="color:var(--muted);padding:16px;text-align:center;font-size:12px;">No saved movies</div>'; return; }
            list.innerHTML = saved.slice(0, 12).map(m => '<div class="saved-item"><img src="' + m.poster + '"><div class="saved-item-info"><div class="saved-item-title">' + m.title + '</div><div class="saved-item-meta">' + m.year + '</div></div></div>').join('');
        }
        function renderManageList() {
            var list = document.getElementById('manageList'); var search = document.getElementById('manageSearch').value.toLowerCase();
            var filtered = movies.filter(m => m.title.toLowerCase().indexOf(search) !== -1);
            document.getElementById('manageCount').textContent = movies.length;
            if (filtered.length === 0) { list.innerHTML = '<div style="text-align:center;padding:20px;color:var(--muted);font-size:12px;">No movies found</div>'; return; }
            list.innerHTML = filtered.map(m => '<div class="saved-item"><img src="' + m.poster + '"><div class="saved-item-info"><div class="saved-item-title">' + m.title + '</div><div class="saved-item-meta">' + m.year + ' | ' + m.type + '</div></div>' +
                '<div style="display:flex;gap:6px;"><button class="btn-edit" onclick="editMovie(\'' + m.id + '\')">Edit</button><button class="btn-delete" onclick="deleteMovie(\'' + m.id + '\')">Del</button></div></div>').join('');
        }
        
        function editMovie(id) {
            var movie = movies.find(m => m.id === id); if (!movie) return; editingMovieId = id;
            document.getElementById('manualTitle').value = movie.title || '';
            document.getElementById('manualYear').value = movie.year || '';
            document.getElementById('manualRating').value = movie.rating || '';
            document.getElementById('manualDuration').value = movie.duration || '';
            document.getElementById('manualType').value = movie.type || 'movie';
            document.getElementById('manualQuality').value = movie.quality || 'WEB-DL';
            document.getElementById('manualPoster').value = movie.poster || '';
            document.getElementById('manualGenres').value = (movie.genres || []).join(', ');
            document.getElementById('manualSynopsis').value = movie.synopsis || '';
            toggleManualSeasons();
            if(movie.type === 'series' && movie.seasons){
                if(movie.seasons[0]){
                    document.getElementById('manualSeasonSelect').value = movie.seasons[0].season_number;
                    updateManualEpisodes();
                    if(movie.seasons[0].episodes[0]){
                        document.getElementById('manualEpisodeSelect').value = movie.seasons[0].episodes[0].episode_number;
                        detailServers = movie.seasons[0].episodes[0].downloads || [];
                        renderManualEpisodeLinks();
                    }
                }
            } else { detailServers = movie.downloads || []; renderManualEpisodeLinks(); }
            movies = movies.filter(m => m.id !== editingMovieId);
            switchAdminTab('manual');
            showNotification('Edit mode: Update and Save');
        }
        
        function deleteMovie(id) { if (!confirm('Delete?')) return; movies = movies.filter(m => m.id !== id); saveMovies(); renderAll(); renderManageList(); showNotification('Deleted!'); }

        // ================== BACKUP ==================
        function exportAll() { var json = JSON.stringify(movies, null, 2); var blob = new Blob([json], { type: 'application/json' }); var url = URL.createObjectURL(blob); var a = document.createElement('a'); a.href = url; a.download = 'ysflix_backup.json'; a.click(); URL.revokeObjectURL(url); showNotification('Exported!'); }
        function importData(e) {
            var file = e.target.files[0]; if (!file) return; var reader = new FileReader();
            reader.onload = function(ev) {
                try { var imported = JSON.parse(ev.target.result); if (Array.isArray(imported)) { movies = imported.concat(movies); saveMovies(); renderAll(); renderManageList(); showNotification('Imported ' + imported.length + ' movies!'); } else { showNotification('Invalid format!'); } }
                catch (err) { showNotification('Invalid file!'); }
            };
            reader.readAsText(file); e.target.value = '';
        }
        function clearAllData() { if (!confirm('Delete ALL?')) return; if (!confirm('Really?')) return; movies = []; saveMovies(); renderAll(); renderManageList(); showNotification('Cleared!'); }

        // ================== RENDER ==================
        function renderAll() { renderHome(); updateGenreCounts(); }
        function renderHome() {
            renderHomeMovies(movies.filter(m => m.type === 'movie').slice(0, 6));
            renderHomeSeries(movies.filter(m => m.type === 'series').slice(0, 6));
            renderGenreGrid('homeGenreGrid');
        }
        function renderHomeMovies(list) {
            var grid = document.getElementById('homeMoviesGrid');
            if (list.length === 0) { grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:24px;color:var(--muted);font-size:13px;">No movies</div>'; return; }
            grid.innerHTML = list.map(m => createCard(m)).join('');
        }
        function renderHomeSeries(list) {
            var grid = document.getElementById('homeSeriesGrid');
            if (list.length === 0) { grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:24px;color:var(--muted);font-size:13px;">No series</div>'; return; }
            grid.innerHTML = list.map(m => createCard(m)).join('');
        }
        function renderMoviesPage() { renderPaginated('moviesGrid', 'moviesPagination', movies.filter(m => m.type === 'movie')); }
        function renderSeriesPage() { renderPaginated('seriesGrid', 'seriesPagination', movies.filter(m => m.type === 'series')); }
        function renderPaginated(gridId, pagId, list) {
            var totalPages = Math.ceil(list.length / ITEMS_PER_PAGE);
            var start = (currentPage - 1) * ITEMS_PER_PAGE; var end = start + ITEMS_PER_PAGE;
            var pageList = list.slice(start, end);
            var grid = document.getElementById(gridId);
            if (pageList.length === 0) { grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:24px;color:var(--muted);font-size:13px;">No content</div>'; }
            else { grid.innerHTML = pageList.map(m => createCard(m)).join(''); }
            var pag = document.getElementById(pagId);
            if (totalPages <= 1) { pag.innerHTML = ''; return; }
            var html = '<button class="page-btn" onclick="changePage(-1)"' + (currentPage === 1 ? ' disabled' : '') + '>&larr;</button>';
            for (var i = 1; i <= totalPages; i++) { if (i === 1 || i === totalPages || (i >= currentPage - 1 && i <= currentPage + 1)) { html += '<button class="page-btn' + (i === currentPage ? ' active' : '') + '" onclick="goToPage(' + i + ')">' + i + '</button>'; } else if (i === currentPage - 2 || i === currentPage + 2) { html += '<span style="color:var(--muted);">...</span>'; } }
            html += '<button class="page-btn" onclick="changePage(1)"' + (currentPage === totalPages ? ' disabled' : '') + '>&rarr;</button>';
            pag.innerHTML = html;
        }
        function changePage(dir) { currentPage += dir; if (currentSection === 'movies') renderMoviesPage(); else if (currentSection === 'series') renderSeriesPage(); }
        function goToPage(page) { currentPage = page; if (currentSection === 'movies') renderMoviesPage(); else if (currentSection === 'series') renderSeriesPage(); }
        function renderGenreGrid(gridId) {
            var grid = document.getElementById(gridId);
            grid.innerHTML = genres.map(g => '<div class="genre-card" onclick="filterByGenre(\'' + g.name + '\')"><span class="genre-icon">' + g.icon + '</span><span class="genre-name">' + g.name + '</span><span class="genre-count">' + g.count + '</span></div>').join('');
        }
        function renderGenresPage() {
            renderGenreGrid('genresGridFull');
            var tagsGrid = document.getElementById('tagsGrid');
            tagsGrid.innerHTML = tags.map(t => '<div class="tag-card"><span style="font-size:12px;">' + t.name + '</span><span style="font-size:11px;color:var(--muted);">' + t.count + '</span></div>').join('');
        }
        function updateGenreCounts() { genres.forEach(g => { g.count = movies.filter(m => (m.genres || []).indexOf(g.name) !== -1).length; }); tags.forEach(t => { t.count = Math.floor(Math.random() * 50) + 10; }); }
        function filterByGenre(name) {
            navigateTo('movies');
            setTimeout(function() {
                var filtered = movies.filter(m => (m.genres || []).indexOf(name) !== -1);
                var grid = document.getElementById('moviesGrid');
                if (filtered.length === 0) { grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:24px;color:var(--muted);font-size:13px;">No movies in ' + name + '</div>'; }
                else { grid.innerHTML = filtered.map(m => createCard(m)).join(''); }
                document.getElementById('moviesPagination').innerHTML = '';
            }, 50);
        }
        function createCard(movie) {
            return '<div class="movie-card" onclick="openMovieModal(\'' + movie.id + '\')"><div class="movie-poster"><img src="' + movie.poster + '" loading="lazy" onerror="this.src=\'https://picsum.photos/seed/' + movie.id + '/400/600\'"><span class="year-badge">' + movie.year + '</span><span class="rating-badge">' + (movie.rating || 0).toFixed(1) + '</span><span class="quality-badge">' + (movie.quality || 'WEB-DL') + '</span></div><div class="movie-info"><div class="movie-title">' + movie.title + '</div><div class="movie-meta">' + movie.duration + '</div></div></div>';
        }

        // ================== MOVIE MODAL ==================
        function openMovieModal(id) {
            var movie = movies.find(m => m.id === id); if (!movie) return;
            
            var seasonHtml = '';
            if(movie.type === 'series' && movie.seasons && movie.seasons.length > 0){
                seasonHtml = '<div style="margin-top:14px;padding-top:14px;border-top:1px solid var(--border);">' +
                    '<h4 style="font-size:13px;font-weight:600;margin-bottom:10px;">Episodes</h4>' +
                    '<div style="display:flex;gap:12px;margin-bottom:12px;">' +
                        '<select id="modalSeasonSelect" class="form-select" style="padding:8px 12px;font-size:12px;" onchange="changeModalSeason()">' +
                        movie.seasons.map(s => '<option value="'+s.season_number+'">Season '+s.season_number+'</option>').join('') +
                        '</select>' +
                        '<select id="modalEpisodeSelect" class="form-select" style="padding:8px 12px;font-size:12px;" onchange="changeModalEpisode()"></select>' +
                    '</div>' +
                    '<div id="modalLinks"></div>' +
                '</div>';
            }

            document.getElementById('movieModalContent').innerHTML = 
                '<div style="display:flex;gap:16px;flex-wrap:wrap;"><img src="' + movie.poster + '" style="width:120px;height:180px;object-fit:cover;border-radius:8px;"><div style="flex:1;min-width:200px;">' +
                '<h2 style="font-family:\'Bebas Neue\',sans-serif;font-size:26px;letter-spacing:1px;margin-bottom:8px;">' + movie.title + '</h2>' +
                '<div style="display:flex;gap:12px;font-size:13px;margin-bottom:8px;"><span style="color:var(--accent);">' + (movie.rating || 0).toFixed(1) + '</span><span style="color:var(--muted);">' + movie.year + '</span><span style="color:var(--muted);">' + movie.duration + '</span></div>' +
                '<div style="display:flex;gap:6px;flex-wrap:wrap;margin-bottom:10px;">' + (movie.genres || []).map(g => '<span style="background:var(--bg-secondary);border-radius:4px;padding:4px 8px;font-size:10px;color:var(--muted);">' + g + '</span>').join('') + '</div>' +
                '<div style="font-size:12px;color:var(--muted);line-height:1.6;"><p><b>Director:</b> ' + (movie.director || 'N/A') + '</p><p><b>Release:</b> ' + (movie.releaseDate || 'N/A') + '</p></div></div></div>' +
                '<div style="margin-top:14px;padding-top:14px;border-top:1px solid var(--border);"><h4 style="font-size:13px;font-weight:600;margin-bottom:8px;">Synopsis</h4><p style="font-size:12px;color:var(--muted);line-height:1.7;">' + (movie.synopsis || 'No synopsis.') + '</p></div>' +
                (movie.type === 'movie' && movie.downloads && movie.downloads.length ? renderDownloadTable(movie.downloads) : '') +
                seasonHtml;

            if(movie.type === 'series' && movie.seasons){
                window.currentModalMovie = movie;
                changeModalSeason();
            }
            
            document.getElementById('movieModal').classList.add('active');
        }

        function changeModalSeason(){
            var movie = window.currentModalMovie; if(!movie) return;
            var seasonNum = parseInt(document.getElementById('modalSeasonSelect').value);
            var season = movie.seasons.find(s=>s.season_number === seasonNum);
            var epSel = document.getElementById('modalEpisodeSelect');
            if(season){
                epSel.innerHTML = season.episodes.map(ep=>'<option value="'+ep.episode_number+'">Episode '+ep.episode_number+'</option>').join('');
                changeModalEpisode();
            }
        }

        function changeModalEpisode(){
            var movie = window.currentModalMovie; if(!movie) return;
            var seasonNum = parseInt(document.getElementById('modalSeasonSelect').value);
            var epNum = parseInt(document.getElementById('modalEpisodeSelect').value);
            var season = movie.seasons.find(s=>s.season_number === seasonNum);
            var episode = season.episodes.find(ep=>ep.episode_number === epNum);
            var linksDiv = document.getElementById('modalLinks');
            
            if(showDownloads && episode && episode.downloads && episode.downloads.length > 0){
                linksDiv.innerHTML = renderDownloadTable(episode.downloads);
            } else {
                linksDiv.innerHTML = '<div class="download-warning"><p>No links available or hidden</p></div>';
            }
        }

        function renderDownloadTable(downloads){
            return '<div style="margin-top:8px;"><table class="download-table"><thead><tr><th>Server</th><th>Size</th><th>Quality</th><th>Action</th></tr></thead><tbody>' +
                downloads.map(d => '<tr><td>'+d.server+'</td><td>'+d.size+'</td><td>'+d.quality+' '+(d.resolution||'')+'</td><td><a href="'+(d.url||'#')+'" target="_blank" class="download-link">Download</a></td></tr>').join('') +
            '</tbody></table></div>';
        }

        function closeMovieModal() { document.getElementById('movieModal').classList.remove('active'); window.currentModalMovie = null; }

        // ================== UTILS ==================
        function showNotification(msg) { var n = document.getElementById('notification'); n.textContent = msg; n.classList.add('show'); setTimeout(function() { n.classList.remove('show'); }, 2200); }

        // ================== START ==================
        init();
    </script>
</body>
</html>